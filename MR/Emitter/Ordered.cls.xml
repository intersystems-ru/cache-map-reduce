<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="MR.Emitter.Ordered">
<Description>
emitter whch maintains the order of (key,value(s))</Description>
<Super>%RegisteredObject,MR.Base.Emitter</Super>
<TimeCreated>63660,85075.197628</TimeCreated>

<Property name="GlobalName">
<Description>
global name serving as data channel</Description>
<Type>%String</Type>
</Property>

<Parameter name="AUTOCLEANUP">
<Description>
TODO - automatically cleanup global name upon exiting</Description>
<Default>1</Default>
</Parameter>

<Method name="%OnNew">
<FormalSpec>initval:%String</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
    $$$ThrowOnError($length(initval)>0)
    set ..GlobalName = initval ; FIXME - valid global name
    quit $$$OK
]]></Implementation>
</Method>

<Method name="IsEmpty">
<ReturnType>%Boolean</ReturnType>
<Implementation><![CDATA[
    #dim name As %String = ..GlobalName
    quit ($data(@name)/10)=0
]]></Implementation>
</Method>

<Method name="Emit">
<Description>
emit $listbuild(key,value)</Description>
<FormalSpec>ListBuild:%String</FormalSpec>
<Implementation><![CDATA[
    $$$ThrowOnError($listvalid(ListBuild))
    #dim name As %String = ..GlobalName
    set @name@($seq(@name)) = ListBuild
]]></Implementation>
</Method>

<Method name="Fetch">
<Description>
returns emitted $lb(key,value)</Description>
<ReturnType>%String</ReturnType>
<Implementation><![CDATA[
    #dim name As %String = ..GlobalName
    #dim value As %String
    #dim index As %String = $order(@name@(""),1,value)
    if index'="" {
        kill @name@(index)
        quit value
    } else {
        kill @name
        quit ""
    }
]]></Implementation>
</Method>

<Method name="Dump">
<Implementation><![CDATA[
    #dim name As %String = ..GlobalName
    zwrite @name
]]></Implementation>
</Method>
</Class>
</Export>
