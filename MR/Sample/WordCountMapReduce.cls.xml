<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="MR.Sample.WordCountMapReduce">
<Description>
Very simple, single-threaded "map-reduce" example.
BEWARE! 
There is no intermediate controlling node before reducer, because MR.Emitter.Sorted 
is automagically reduce and sort key values set to the single node because of using hierarchical 
global array. </Description>
<Super>%RegisteredObject</Super>
<TimeCreated>63676,63054.129416</TimeCreated>

<Method name="MapReduce">
<ClassMethod>1</ClassMethod>
<ProcedureBlock>0</ProcedureBlock>
<Implementation><![CDATA[
    new
    kill ^mtemp.Map,^mtemp.Reduce

    for i=1:1 {
        #dim fileName As %String = $piece($Text(DATA+i),";",3)
        quit:fileName=""

        #dim inputFile As MR.Sample.FileMapInput = ##class(MR.Sample.FileMapInput).%New(fileName)
        #dim intraPipeName As %String = $name(^mtemp.Map($J))
        #dim mapper As MR.Sample.WordCounter = ##class(MR.Sample.WordCounter).%New(intraPipeName)
        while 'inputFile.IsAtEnd() {
            do mapper.Map(inputFile)
        }
        //do mapper.Dump()
        
        #dim reduceInput As MR.Sample.GlobalPipeInput = ##class(MR.Sample.GlobalPipeInput).%New(intraPipeName)
        #dim outPipeName As %String = $name(^mtemp.Reduce($J))
        #dim reducer As MR.Sample.Adder = ##class(MR.Sample.Adder).%New(outPipeName)
        while 'reduceInput.IsAtEnd() {
            do reducer.Reduce(reduceInput)
        }
        do reducer.Dump()
    }
    quit
    
DATA
    ;;C:\Users\Timur\Documents\Intersystems\src\work\mapreduce\data\war_an_peace_vol1.txt
    ;;C:\Users\Timur\Documents\Intersystems\src\work\mapreduce\data\war_an_peace_vol2.txt
    ;;C:\Users\Timur\Documents\Intersystems\src\work\mapreduce\data\war_an_peace_vol3.txt
    ;;C:\Users\Timur\Documents\Intersystems\src\work\mapreduce\data\war_an_peace_vol4.txt
    ;;
    ;;C:\Users\Timur\Documents\Intersystems\src\work\mapreduce\data\single-line.txt
]]></Implementation>
</Method>
</Class>
</Export>
